let vp_player,vp_video,vp_ctl_play_pause,vp_ctl_sound,vp_ctl_slower,vp_ctl_speed_indicator,vp_ctl_faster,vp_ctl_pip,vp_ctl_fullsrc,playSpeedDef=3,playSpeedCur=playSpeedDef,playSpeeds=[.25,.5,.75,1,1.25,1.5,2,4,8,16];function init_time_codes(){for(var e=document.getElementsByTagName("timecode"),t=0;t<e.length;t++){var p=e[t];p.title="Перейти на "+p.innerText+" в проигрывателе",p.onclick=function(e){var t=str2dur(e.currentTarget.innerText);t<=vp_video.duration?(vp_video.currentTime=t,vp_video.play()):(e.currentTarget.style.color="red",alert("Тайм-код за пределами длительности видео."))}}}function str2dur(e){for(var t=e.split(":",3).reverse(),p=0,l=[1,60,3600],c=0;c<t.length;c++)p+=parseInt(t[c])*l[c];return p}function dur2str(e){var t=Math.trunc(e/60),p=Math.trunc(t/60),l=Math.trunc(e-60*(60*p+t)),c=t+":"+(l<10?"0"+l:l);return t>=60&&(c=p+":"+c),c}function changeButtonState(e,t,p){e.innerHTML=p,e.title=t}function setPlaySpeed(e){playSpeedCur=e,vp_video.playbackRate=playSpeeds[e]}window.onload=function(){vp_player=document.querySelector("#video-player"),vp_video=document.querySelector("#video-player video"),vp_ctl_play_pause=document.querySelector("#vp-ctl-play-pause"),vp_ctl_sound=document.querySelector("#vp-ctl-sound"),vp_ctl_slower=document.querySelector("#vp-ctl-slower"),vp_ctl_speed_indicator=document.querySelector("#vp-ctl-speed-indicator"),vp_ctl_faster=document.querySelector("#vp-ctl-faster"),vp_ctl_pip=document.querySelector("#vp-ctl-pip"),vp_ctl_fullsrc=document.querySelector("#vp-ctl-fullsrc"),vp_player.onfullscreenchange=function(e){document.fullscreen?changeButtonState(vp_ctl_fullsrc,"Выход из полноэкранного режима (f)",svg_fullscr_leave):changeButtonState(vp_ctl_fullsrc,"Во весь экран (f)",svg_fullscr_enter)},vp_video.onplay=function(){changeButtonState(vp_ctl_play_pause,"Пауза (K)",svg_pause)},vp_video.onpause=function(){changeButtonState(vp_ctl_play_pause,"Смотреть (K)",svg_play)},vp_video.onvolumechange=function(){0==vp_video.volume?changeButtonState(vp_ctl_sound,"Отключение звука (m)",svg_sound_mute):vp_video.volume<.5?changeButtonState(vp_ctl_sound,"Отключение звука (m)",svg_sound_middle):changeButtonState(vp_ctl_sound,"Отключение звука (m)",svg_sound_max)},vp_video.onratechange=function(){vp_ctl_slower.disabled=playSpeedCur<=0,vp_ctl_faster.disabled=playSpeedCur>=playSpeeds.length-1,vp_ctl_speed_indicator.disabled=playSpeedCur==playSpeedDef,vp_ctl_speed_indicator.title=playSpeedCur==playSpeedDef?"Текущая скорость воспроизведения":"К нормальной скорости воспроизведения (s)",vp_ctl_speed_indicator.querySelector("#vp-ctl-speed-indicator-content").innerText="x"+vp_video.playbackRate},vp_video.onenterpictureinpicture=function(){changeButtonState(vp_ctl_pip,"Закрыть мини проигрыватель (I)",svg_pip_leave)},vp_video.onleavepictureinpicture=function(){changeButtonState(vp_ctl_pip,"Открыть мини проигрыватель (I)",svg_pip_enter)},vp_ctl_play_pause.onclick=function(e){vp_ctl_play_pause.blur(),vp_video.paused?vp_video.play():vp_video.pause()},vp_ctl_sound.onclick=function(e){vp_ctl_sound.blur(),vp_video.volume=vp_video.volume>0?0:1},vp_ctl_slower.onclick=function(e){vp_ctl_slower.blur(),vp_ctl_slower.disabled||setPlaySpeed(playSpeedCur-1)},vp_ctl_speed_indicator.onclick=function(e){vp_ctl_speed_indicator.blur(),setPlaySpeed(playSpeedDef)},vp_ctl_faster.onclick=function(e){vp_ctl_faster.blur(),vp_ctl_faster.disabled||setPlaySpeed(playSpeedCur+1)},vp_ctl_pip.onclick=function(e){vp_ctl_pip.blur(),document.pictureInPictureElement?document.exitPictureInPicture():vp_video.requestPictureInPicture()},vp_ctl_fullsrc.onclick=function(e){vp_ctl_fullsrc.blur(),document.fullscreen?document.exitFullscreen():vp_player.requestFullscreen()},document.onkeyup=function(e){70==e.keyCode?vp_ctl_fullsrc.onclick():72==e.keyCode?console.error("NotImplemented - hot key Step Back "):73==e.keyCode?vp_ctl_pip.onclick():74==e.keyCode?vp_ctl_slower.onclick():75==e.keyCode?vp_video.paused?vp_ctl_play_pause.onclick():1!=vp_video.playbackRate?(vp_video.playbackRate=1,setPlaySpeed(playSpeedDef)):vp_ctl_play_pause.onclick():76==e.keyCode?vp_ctl_faster.onclick():77==e.keyCode?vp_ctl_sound.onclick():186==e.keyCode&&console.error("NotImplemented - hot key Forward Back ")},vp_ctl_speed_indicator.disabled=!0,init_time_codes()};let svg_play="<svg viewBox='0 0 36 36'><path d='M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z'/></svg>",svg_pause="<svg viewBox='0 0 36 36'><path d='M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z'/></svg>",svg_sound_max="<svg viewBox='0 0 36 36'><path d='M8,21 L12,21 L17,26 L17,10 L12,15 L8,15 L8,21 Z M19,14 L19,22 C20.48,21.32 21.5,19.77 21.5,18 C21.5,16.26 20.48,14.74 19,14 ZM19,11.29 C21.89,12.15 24,14.83 24,18 C24,21.17 21.89,23.85 19,24.71 L19,26.77 C23.01,25.86 26,22.28 26,18 C26,13.72 23.01,10.14 19,9.23 L19,11.29 Z'/></svg>",svg_sound_middle="<svg viewBox='0 0 36 36'><path d='m 14.35,-0.14 -5.86,5.86 20.73,20.78 5.86,-5.91 z'/><path d='M 7.07,6.87 -1.11,15.33 19.61,36.11 27.80,27.60 z'/><path d='M 9.09,5.20 6.47,7.88 26.82,28.77 29.66,25.99 z'/><path d='m -11.45,-15.55 -4.44,4.51 20.45,20.94 4.55,-4.66 z'/><path d='M8,21 L12,21 L17,26 L17,10 L12,15 L8,15 L8,21 Z M19,14 L19,22 C20.48,21.32 21.5,19.77 21.5,18 C21.5,16.26 20.48,14.74 19,14 Z'/><path d='M 9.25,9 7.98,10.27 24.71,27 l 1.27,-1.27 Z'/></svg>",svg_sound_mute="<svg viewBox='0 0 36 36'><path d='m 21.48,17.98 c 0,-1.77 -1.02,-3.29 -2.5,-4.03 v 2.21 l 2.45,2.45 c .03,-0.2 .05,-0.41 .05,-0.63 z m 2.5,0 c 0,.94 -0.2,1.82 -0.54,2.64 l 1.51,1.51 c .66,-1.24 1.03,-2.65 1.03,-4.15 0,-4.28 -2.99,-7.86 -7,-8.76 v 2.05 c 2.89,.86 5,3.54 5,6.71 z M 9.25,8.98 l -1.27,1.26 4.72,4.73 H 7.98 v 6 H 11.98 l 5,5 v -6.73 l 4.25,4.25 c -0.67,.52 -1.42,.93 -2.25,1.18 v 2.06 c 1.38,-0.31 2.63,-0.95 3.69,-1.81 l 2.04,2.05 1.27,-1.27 -9,-9 -7.72,-7.72 z m 7.72,.99 -2.09,2.08 2.09,2.09 V 9.98 z'/></svg>",svg_pip_enter="<svg viewBox='0 0 36 36'><path d='M25,17 L17,17 L17,23 L25,23 L25,17 L25,17 z M29,25 L29,10.98 C29,9.88 28.1,9 27,9 L9,9 C7.9,9 7,9.88 7,10.98 L7,25 C7,26.1 7.9,27 9,27 L27,27 C28.1,27 29,26.1 29,25 L29,25 z M27,25.02 L9,25.02 L9,10.97 L27,10.97 L27,25.02 L27,25.02 z'/></svg>",svg_pip_leave="<svg viewBox='0 0 36 36'><path d='M11,13 V23 H25 V13 z M29,25 L29,10.98 C29,9.88 28.1,9 27,9 L9,9 C7.9,9 7,9.88 7,10.98 L7,25 C7,26.1 7.9,27 9,27 L27,27 C28.1,27 29,26.1 29,25 L29,25 z M27,25.02 L9,25.02 L9,10.97 L27,10.97 L27,25.02 L27,25.02 z'/></svg>",svg_fullscr_enter="<svg viewBox='0 0 36 36'><path d='m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z'/><path d='m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z' /><path d='m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z'/><path d='M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z'/></svg>",svg_fullscr_leave="<svg viewBox='0 0 36 36'><path d='m 14,14 -4,0 0,2 6,0 0,-6 -2,0 0,4 0,0 z'/><path d='m 22,14 0,-4 -2,0 0,6 6,0 0,-2 -4,0 0,0 z'/><path d='m 20,26 2,0 0,-4 4,0 0,-2 -6,0 0,6 0,0 z'/><path d='m 10,22 4,0 0,4 2,0 0,-6 -6,0 0,2 0,0 z'/></svg>";